"use strict";(self["webpackChunksus_front_celular_2"]=self["webpackChunksus_front_celular_2"]||[]).push([[395],{6395:function(e,t,s){s.r(t),s.d(t,{default:function(){return k}});var i=s(3396),a=s(7139);const n=e=>((0,i.dD)("data-v-35bda5d4"),e=e(),(0,i.Cn)(),e),l={class:"TopPanel"},o={class:"TipoAtend"},r={class:"subTypeName"},c={class:"TipoAtend"},h={class:"subTypeName"},d={class:"Senha"},u={class:"senhaNumb"},m={class:"prefix"},p={class:"sNumb"},g={key:0,class:"mensagemRecepcao"},S=n((()=>(0,i._)("div",{class:"mensagemRecepcao2"},"A sua vez chegou !",-1))),_={class:"mensagemRecepcao2"};function v(e,t,s,n,v,C){return(0,i.wg)(),(0,i.iD)("main",{class:(0,a.C_)(v.cSalaDeEspera)},[(0,i._)("div",l,[(0,i._)("div",o,[(0,i.Uk)(" Tipo de atendimento: "),(0,i._)("label",r,(0,a.zw)(v.TypeAtend),1)]),(0,i._)("div",c,[(0,i.Uk)(" Tipo de especialidade: "),(0,i._)("label",h,(0,a.zw)(v.sSelection),1)])]),(0,i._)("div",d,[(0,i._)("div",u,[(0,i._)("label",m,(0,a.zw)(v.sPrefix),1),(0,i._)("label",p,(0,a.zw)(v.senha),1)]),"SalaDeEsperaAtiva"===v.cSalaDeEspera?((0,i.wg)(),(0,i.iD)("div",g,[S,(0,i._)("div",_,"Favor dirija-se ao balcão Nº "+(0,a.zw)(String(v.balcaoNumb).padStart(2,"0")),1)])):(0,i.kq)("",!0)])],2)}s(7658);var C=s(4161),f=s(2066);const b=(0,f.io)("https://vizinhoapi.herokuapp.com/"),A=C.Z.create();var w={data(){return{sPrefix:null,sSelection:null,cliente:null,TypeAtend:null,senha:0,BASE_URL:null,cSalaDeEspera:"SalaDeEspera",rConsult:null,messageContainer:null,ioclient:b,returnServerMsg:[],balcaoNumb:null}},beforeMount(){this.verifySection()},mounted(){this.BASE_URL="https://vizinhoapi.herokuapp.com/",this.sPrefix=localStorage.getItem("sPrefix"),this.sSelection=localStorage.getItem("sSelection");try{this.sSelection=JSON.parse(this.sSelection).name}catch(e){this.sSelection="Pronto Atendimento"}this.cliente=localStorage.getItem("client"),this.cliente=JSON.parse(this.cliente),this.switchCaseAtend(),this.verifyTriagem(),this.messageContainer=this.$refs.messageContainer,this.socketConnection(),this.waitConnected(),this.waitChamada(),this.waitCancel()},methods:{alertaCliente(){this.cSalaDeEspera="SalaDeEsperaAtiva";var e=`${this.sPrefix}${this.senha}`;if("granted"===Notification.permission){new Notification("SUS Notifications",{body:`${e} Sua vez chegou, por favor, dirija-se ao balcão ${this.bLivre}`})}},verifySection(){let e=localStorage.getItem("secction_page"),t=localStorage.getItem("client");null===t&&(localStorage.setItem("secction_page","home"),localStorage.setItem("sPrefix",null),localStorage.setItem("sSelection",null),this.$router.push("/")),null===e&&(localStorage.setItem("secction_page","home"),localStorage.setItem("sPrefix",null),localStorage.setItem("sSelection",null),localStorage.setItem("client",null),this.$router.push("/"))},zeroAdd(e,t){return String(e).padStart(t,"0")},async verifyTriagem(){let e=this.cliente[0];try{const t=await A.post(this.BASE_URL+"triagem/consult",{client_id:e.idcliente});t.data.response.status?(this.rConsult=t.data.response.triagem[0],this.TypeAtend=this.rConsult.idespec,this.sSelection=this.rConsult.idsubspec,this.sPrefix=this.rConsult.espec_prefix,this.senha=this.zeroAdd(this.rConsult.idtriagem,3),1===this.rConsult.cliente_chamado&&this.alertaCliente()):(this.rConsult=null,this.senha=0)}catch(t){}},switchCaseAtend(){switch(this.sPrefix){case"A":this.TypeAtend="Acolhimento";break;case"S":this.TypeAtend="Área assistencial";break;case"D":this.TypeAtend="Serviço de apoio à diagnose e terapia";break;case"B":this.TypeAtend="Atenção Básica";break;default:break}},waitConnected(){this.ioclient.on("connected",(e=>{this.returnServerMsg.push(e),this.getRooms(),this.getClients(),this.sendJoin(1,"Sala de Espera")}))},waitChamada(){this.ioclient.on("send_ClientAlert",(e=>{let t=e.data[0];this.balcaoNumb=t.balcao;let s=this.cliente;s=s[0].idcliente,s===t.id?this.alertaCliente():this.cSalaDeEspera="SalaDeEspera"}))},waitCancel(){this.ioclient.on("send_ClientCancel",(e=>{let t=e,s=this.cliente[0].idcliente;s===t&&this.$router.push("/")}))},getClients(){this.ioclient.on("clients_list",(e=>{this.pacientes=e}))},getRooms(){this.ioclient.on("rooms_list",(e=>{this.salas=e}))},rolarScroll(){},socketConnection(){this.ioclient.on("send_message",(e=>{this.returnServerMsg.push(e),this.rolarScroll()}))},sendJoin(e,t){this.ioclient.emit("join",{userId:e,room:t})},sendText(){this.ioclient.emit("send_message",{name:"usuário",message:this.messageText}),this.messageText=null},sendHello(){this.ioclient.emit("send_message",{name:"usuário",message:"Olá, servidor!"}),this.ioclient.emit("send_message",{name:"usuário",message:"Olá, sala!"})}}},T=s(89);const y=(0,T.Z)(w,[["render",v],["__scopeId","data-v-35bda5d4"]]);var k=y}}]);
//# sourceMappingURL=395.3820017b.js.map