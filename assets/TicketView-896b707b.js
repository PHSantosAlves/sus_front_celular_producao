import{_ as r,a as h,o as n,c as l,b as s,e as c,t as o,d,n as p,p as m,f as u}from"./index-360f0597.js";import{l as _}from"./index-412481e9.js";const S=_("https://vizinhoapi.herokuapp.com/"),g=h.create(),f={data(){return{sPrefix:null,sSelection:null,cliente:null,TypeAtend:null,senha:0,BASE_URL:null,cSalaDeEspera:"SalaDeEspera",rConsult:null,messageContainer:null,ioclient:S,returnServerMsg:[],balcaoNumb:null}},beforeMount(){this.verifySection()},mounted(){this.BASE_URL="https://vizinhoapi.herokuapp.com/",this.sPrefix=localStorage.getItem("sPrefix"),this.sSelection=localStorage.getItem("sSelection");try{this.sSelection=JSON.parse(this.sSelection).name}catch{this.sSelection="Pronto Atendimento"}this.cliente=localStorage.getItem("client"),this.cliente=JSON.parse(this.cliente),this.switchCaseAtend(),this.verifyTriagem(),this.messageContainer=this.$refs.messageContainer,this.socketConnection(),this.waitConnected(),this.waitChamada(),this.waitCancel()},methods:{alertaCliente(){this.cSalaDeEspera="SalaDeEsperaAtiva";var e=`${this.sPrefix}${this.senha}`;Notification.permission==="granted"&&new Notification("SUS Notifications",{body:`${e} Sua vez chegou, por favor, dirija-se ao balcão ${this.bLivre}`})},verifySection(){let e=localStorage.getItem("secction_page");localStorage.getItem("client")===null&&(localStorage.setItem("secction_page","home"),localStorage.setItem("sPrefix",null),localStorage.setItem("sSelection",null),this.$router.push("/")),e===null&&(localStorage.setItem("secction_page","home"),localStorage.setItem("sPrefix",null),localStorage.setItem("sSelection",null),localStorage.setItem("client",null),this.$router.push("/"))},zeroAdd(e,t){return String(e).padStart(t,"0")},async verifyTriagem(){let e=this.cliente[0];try{const t=await g.post(this.BASE_URL+"triagem/consult",{client_id:e.idcliente});t.data.response.status?(this.rConsult=t.data.response.triagem[0],this.TypeAtend=this.rConsult.idespec,this.sSelection=this.rConsult.idsubspec,this.sPrefix=this.rConsult.espec_prefix,this.senha=this.zeroAdd(this.rConsult.idtriagem,3),this.rConsult.cliente_chamado===1&&this.alertaCliente()):(this.rConsult=null,this.senha=0)}catch{}},switchCaseAtend(){switch(this.sPrefix){case"A":this.TypeAtend="Acolhimento";break;case"S":this.TypeAtend="Área assistencial";break;case"D":this.TypeAtend="Serviço de apoio à diagnose e terapia";break;case"B":this.TypeAtend="Atenção Básica";break}},waitConnected(){this.ioclient.on("connected",e=>{this.returnServerMsg.push(e),this.getRooms(),this.getClients(),this.sendJoin(1,"Sala de Espera")})},waitChamada(){this.ioclient.on("send_ClientAlert",e=>{let t=e.data[0];this.balcaoNumb=t.balcao;let a=this.cliente;a=a[0].idcliente,a===t.id?this.alertaCliente():this.cSalaDeEspera="SalaDeEspera"})},waitCancel(){this.ioclient.on("send_ClientCancel",e=>{let t=e;this.cliente[0].idcliente===t&&this.$router.push("/")})},getClients(){this.ioclient.on("clients_list",e=>{this.pacientes=e})},getRooms(){this.ioclient.on("rooms_list",e=>{this.salas=e})},rolarScroll(){},socketConnection(){this.ioclient.on("send_message",e=>{this.returnServerMsg.push(e),this.rolarScroll()})},sendJoin(e,t){this.ioclient.emit("join",{userId:e,room:t})},sendText(){this.ioclient.emit("send_message",{name:"usuário",message:this.messageText}),this.messageText=null},sendHello(){this.ioclient.emit("send_message",{name:"usuário",message:"Olá, servidor!"}),this.ioclient.emit("send_message",{name:"usuário",message:"Olá, sala!"})}}},C=e=>(m("data-v-c4b6f579"),e=e(),u(),e),v={class:"TopPanel"},b={class:"TipoAtend"},A={class:"subTypeName"},T={class:"TipoAtend"},y={class:"subTypeName"},x={class:"Senha"},I={class:"senhaNumb"},N={class:"prefix"},k={class:"sNumb"},w={key:0,class:"mensagemRecepcao"},E=C(()=>s("div",null,"A sua vez chegou !",-1));function D(e,t,a,P,i,B){return n(),l("main",{class:p(i.cSalaDeEspera)},[s("div",v,[s("div",b,[c(" Tipo de atendimento: "),s("label",A,o(i.TypeAtend),1)]),s("div",T,[c(" Tipo de especialidade: "),s("label",y,o(i.sSelection),1)])]),s("div",x,[s("div",I,[s("label",N,o(i.sPrefix),1),s("label",k,o(i.senha),1)]),i.cSalaDeEspera==="SalaDeEsperaAtiva"?(n(),l("div",w,[E,s("div",null,"Favor dirija-se ao balcão Nº "+o(String(i.balcaoNumb).padStart(2,"0")),1)])):d("",!0)])],2)}const V=r(f,[["render",D],["__scopeId","data-v-c4b6f579"]]);export{V as default};
